# 台股主力資金進入篩選器 - Pine Script邏輯修正版本

## 🎯 系統概述

這是一個基於真實台股資料的Pine Script主力進場篩選系統，使用台灣證券交易所官方API提供準確的技術分析結果。

**此版本專門修正Pine Script篩選邏輯，確保只有真正符合主力進場條件的股票才會被篩選出來。**

## 🔧 Pine Script邏輯修正

### 問題發現
原始版本存在以下問題：
1. **技術指標計算錯誤**: 多空線數值異常高（如台積電1146.67）
2. **篩選條件寬鬆**: 只檢查signal_status而非嚴格的Pine Script條件
3. **crossover邏輯不準確**: 未正確實施突破檢查

### 修正方案
1. **嚴格的Pine Script條件檢查**:
   ```python
   # 主力進場條件：同時滿足兩個條件
   is_crossover = (current_fund > current_bull_bear) and (previous_fund <= previous_bull_bear)
   is_oversold = current_bull_bear < 25
   banker_entry_signal = is_crossover and is_oversold
   ```

2. **技術指標範圍修正**:
   - 資金流向趨勢: 0-100範圍
   - 多空線: 0-100範圍
   - 正確的27期和34期計算

3. **嚴格篩選邏輯**:
   ```python
   # 只有banker_entry_signal為True才符合條件
   if stock.get('banker_entry_signal', False):
       filtered_stocks.append(stock)
   ```

## ✅ 修正驗證結果

### 測試結果
```
✅ 符合Pine Script主力進場條件: 0 支
❌ 不符合Pine Script主力進場條件: 5 支
   2330 台積電 - 資金流向: 90.92, 多空線: 91.57 [crossover:✗, 超賣:✗]
   2317 鴻海 - 資金流向: 97.21, 多空線: 84.50 [crossover:✗, 超賣:✗]
   2454 聯發科 - 資金流向: 90.38, 多空線: 84.36 [crossover:✗, 超賣:✗]
   2882 國泰金 - 資金流向: 24.56, 多空線: 27.48 [crossover:✗, 超賣:✗]
   2892 第一金 - 資金流向: 93.86, 多空線: 91.77 [crossover:✗, 超賣:✗]
```

### 修正效果
- ✅ **技術指標正常**: 所有指標都在0-100範圍內
- ✅ **邏輯嚴格**: 沒有股票被錯誤標記為符合條件
- ✅ **條件明確**: 清楚顯示每支股票不符合的具體原因
- ✅ **計算準確**: 基於真實歷史資料的精確計算

## 🚀 Render部署指南

### 部署設定 (邏輯修正版)
```
Name: taiwan-stock-screener
Environment: Python (使用預設版本)
Build Command: pip install --no-cache-dir -r requirements.txt
Start Command: gunicorn app:app
Health Check: /api/health
```

### 關鍵特色
1. **SSL問題解決**: 繞過證書驗證問題
2. **邏輯修正**: 嚴格的Pine Script條件檢查
3. **穩定依賴**: 避免timeout問題
4. **詳細日誌**: 完整的計算過程記錄

## 📊 Pine Script技術分析

### 核心指標
1. **資金流向趨勢** (27期):
   ```
   標準化價格位置 = (收盤價 - 27期最低價) / (27期最高價 - 27期最低價) * 100
   資金流向趨勢 = WMA(WMA(標準化價格位置, 5), 3)
   ```

2. **多空線** (34期 + 13期EMA):
   ```
   標準化價格位置 = (收盤價 - 34期最低價) / (34期最高價 - 34期最低價) * 100
   多空線 = EMA(標準化價格位置, 13)
   ```

### 主力進場條件
```
條件1: crossover(資金流向趨勢, 多空線)
條件2: 多空線 < 25 (超賣區)
主力進場信號 = 條件1 AND 條件2
```

## 🔍 使用方式

1. **訪問應用**: 開啟部署後的URL
2. **更新資料**: 點擊「更新股票資料」按鈕
3. **開始篩選**: 點擊「開始篩選」按鈕
4. **查看結果**: 檢視符合嚴格Pine Script條件的股票

### 預期結果
- **大多數情況下**: 篩選結果為0支股票（這是正常的）
- **特殊市況下**: 可能有1-2支股票符合嚴格條件
- **詳細分析**: 每支股票都會顯示具體的技術指標數值

## 📋 功能特色

### 核心功能
- ✅ **真實資料**: 台灣證券交易所官方API
- ✅ **嚴格邏輯**: 完全按照Pine Script標準實施
- ✅ **詳細分析**: 顯示每支股票的技術指標
- ✅ **準確篩選**: 只顯示真正符合條件的股票

### 技術特色
- ✅ **SSL修復**: 解決證書驗證問題
- ✅ **邏輯修正**: 嚴格的Pine Script條件
- ✅ **範圍檢查**: 技術指標在正確範圍內
- ✅ **詳細日誌**: 完整的計算過程記錄

## ⚠️ 重要說明

### Pine Script的嚴格性
Pine Script主力進場條件非常嚴格：
1. **crossover條件**: 資金流向必須從下方突破多空線
2. **超賣區條件**: 多空線必須小於25
3. **同時滿足**: 兩個條件必須同時成立

### 正常現象
- **大多數時候沒有符合條件的股票**: 這是正常的
- **市場處於高位時**: 很少有股票在超賣區
- **技術分析的本質**: 真正的機會並不常見

### 投資建議
- 此系統僅供技術分析參考
- 投資決策應結合多種因素
- 請注意風險管理

## 🎉 版本特色

### 問題解決
- ✅ **SSL證書問題**: 完全解決證書驗證失敗
- ✅ **Timeout問題**: 使用穩定依賴避免安裝timeout
- ✅ **邏輯錯誤**: 修正Pine Script篩選邏輯
- ✅ **指標異常**: 技術指標在正確範圍內

### 準確性提升
- ✅ **嚴格條件**: 只顯示真正符合條件的股票
- ✅ **詳細分析**: 清楚顯示每支股票的狀態
- ✅ **透明計算**: 完整的技術指標計算過程
- ✅ **可靠結果**: 基於真實市場資料的準確分析

---

**版本**: Pine Script邏輯修正版本  
**更新日期**: 2025-07-27  
**適用平台**: Render.com  
**狀態**: ✅ 已修正所有邏輯問題

