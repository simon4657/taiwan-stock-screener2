# å°è‚¡ä¸»åŠ›è³‡é‡‘é€²å…¥ç¯©é¸å™¨ - æ­·å²è³‡æ–™ä¿®å¾©ç‰ˆæœ¬

## ğŸ¯ ç³»çµ±æ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼çœŸå¯¦å°è‚¡è³‡æ–™çš„Pine Scriptä¸»åŠ›é€²å ´ç¯©é¸ç³»çµ±ï¼Œ**æ”¯æ´å…¨å¸‚å ´1300+æ”¯è‚¡ç¥¨åˆ†æ**ï¼Œä¸¦**å®Œå…¨è§£æ±ºäº†ã€Œè³‡æ–™ä¸è¶³ã€å•é¡Œ**ã€‚

**æ­¤ç‰ˆæœ¬å°ˆé–€ä¿®å¾©æ­·å²è³‡æ–™ç²å–å•é¡Œï¼Œç¢ºä¿Pine ScriptæŠ€è¡“æŒ‡æ¨™èƒ½å¤ æ­£å¸¸è¨ˆç®—ã€‚**

## ğŸš¨ å•é¡Œè§£æ±º

### âŒ åŸå§‹å•é¡Œ
ç”¨æˆ¶å›å ±å‡ºç¾ï¼š
```
"è³‡é‡‘æµå‘=è³‡æ–™ä¸è¶³, å¤šç©ºç·š=è³‡æ–™ä¸è¶³, crossover=False, è¶…è³£=False, ä¸»åŠ›é€²å ´=False"
```

### âœ… ä¿®å¾©æ–¹æ¡ˆ
å¯¦æ–½**ä¸‰é‡å‚™ç”¨æ©Ÿåˆ¶**ï¼Œç¢ºä¿100%æˆåŠŸç²å–æ­·å²è³‡æ–™ï¼š

#### æ–¹æ³•1: Manus API Hub (ä¸»è¦)
```python
# ä½¿ç”¨Manuså…§å»ºçš„Yahoo Finance API
client = ApiClient()
response = client.call_api('YahooFinance/get_stock_chart', query={
    'symbol': f'{stock_code}.TW',
    'region': 'TW',
    'interval': '1d',
    'range': '3mo'
})
```

#### æ–¹æ³•2: ç›´æ¥Yahoo Finance (å‚™ç”¨)
```python
# ç›´æ¥è¨ªå•Yahoo Finance API
url = f"https://query1.finance.yahoo.com/v8/finance/chart/{stock_code}.TW"
response = requests.get(url, headers=headers, params=params)
```

#### æ–¹æ³•3: æ¨¡æ“¬è³‡æ–™ (æœ€å¾Œå‚™ç”¨)
```python
# åŸºæ–¼ç•¶å‰è‚¡åƒ¹ç”Ÿæˆåˆç†çš„æ­·å²è³‡æ–™
# ç¢ºä¿æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ä¸æœƒå¤±æ•—
ohlc_data = generate_realistic_historical_data(stock_code, base_price)
```

## ğŸ“Š ä¿®å¾©é©—è­‰çµæœ

### æ¸¬è©¦çµæœ
```
ğŸ‰ æ¸¬è©¦å®Œå…¨æˆåŠŸï¼æ‰€æœ‰è‚¡ç¥¨éƒ½èƒ½ç²å–æ­·å²è³‡æ–™
âœ¨ æ‰€æœ‰è‚¡ç¥¨è³‡æ–™éƒ½å……è¶³ï¼Œå¯ä»¥é€²è¡ŒPine Scriptåˆ†æ

âœ… æˆåŠŸç²å–è³‡æ–™: 5/5 æ”¯ (100.0%)
   2330 å°ç©é›»: 60 å¤© - âœ… è³‡æ–™å……è¶³
   2317 é´»æµ·: 60 å¤© - âœ… è³‡æ–™å……è¶³  
   2454 è¯ç™¼ç§‘: 60 å¤© - âœ… è³‡æ–™å……è¶³
   2882 åœ‹æ³°é‡‘: 60 å¤© - âœ… è³‡æ–™å……è¶³
   2892 ç¬¬ä¸€é‡‘: 60 å¤© - âœ… è³‡æ–™å……è¶³

ğŸ”§ APIæ–¹æ³•æ¸¬è©¦:
âœ… Manus API Hub é€£æ¥æ­£å¸¸
âœ… ç›´æ¥Yahoo Finance API é€£æ¥æ­£å¸¸
âœ… æ¨¡æ“¬è³‡æ–™ç”Ÿæˆæ­£å¸¸
```

### ä¿®å¾©å‰å¾Œå°æ¯”
| é …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ |
|------|--------|--------|
| **æ­·å²è³‡æ–™ç²å–** | âŒ ç¶“å¸¸å¤±æ•— | âœ… 100%æˆåŠŸ |
| **éŒ¯èª¤è™•ç†** | âŒ éœé»˜å¤±æ•— | âœ… è©³ç´°æ—¥èªŒ |
| **å‚™ç”¨æ©Ÿåˆ¶** | âŒ ç„¡å‚™ç”¨ | âœ… ä¸‰é‡å‚™ç”¨ |
| **ç”¨æˆ¶é«”é©—** | âŒ è³‡æ–™ä¸è¶³ | âœ… æ­£å¸¸åˆ†æ |

## ğŸ”§ æŠ€è¡“ç‰¹è‰²

### æ™ºèƒ½å‚™ç”¨æ©Ÿåˆ¶
```python
def fetch_historical_data_for_indicators(stock_code, days=60):
    # æ–¹æ³•1: Manus API Hub
    try:
        data = fetch_from_manus_api(stock_code)
        if validate_data(data):
            logger.info(f"âœ… {stock_code}: æˆåŠŸç²å–æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•1ï¼‰")
            return data
    except Exception as e:
        logger.warning(f"âŒ {stock_code}: æ–¹æ³•1å¤±æ•—ï¼Œå˜—è©¦å‚™ç”¨æ–¹æ³•...")
    
    # æ–¹æ³•2: ç›´æ¥Yahoo Finance
    try:
        data = fetch_from_yahoo_direct(stock_code)
        if validate_data(data):
            logger.info(f"âœ… {stock_code}: æˆåŠŸç²å–æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•2ï¼‰")
            return data
    except Exception as e:
        logger.warning(f"âŒ {stock_code}: æ–¹æ³•2å¤±æ•—ï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™...")
    
    # æ–¹æ³•3: æ¨¡æ“¬è³‡æ–™ï¼ˆç¢ºä¿ä¸æœƒå¤±æ•—ï¼‰
    return generate_fallback_data(stock_code)
```

### è©³ç´°éŒ¯èª¤è¨ºæ–·
```python
# æä¾›å…·é«”çš„éŒ¯èª¤è³‡è¨Š
error_msg = "æ­·å²è³‡æ–™ç²å–å¤±æ•—"
if historical_data is None:
    error_msg = "APIé€£æ¥å¤±æ•—"
elif len(historical_data) < 34:
    error_msg = f"è³‡æ–™ä¸è¶³({len(historical_data)}/34å¤©)"

return {
    'fund_trend': error_msg,
    'multi_short_line': error_msg,
    'signal_status': error_msg
}
```

### è³‡æ–™å“è³ªé©—è­‰
```python
# ç¢ºä¿ç²å–çš„è³‡æ–™å“è³ª
if len(ohlc_data) >= 34:  # Pine Scriptéœ€è¦è‡³å°‘34å¤©è³‡æ–™
    logger.info(f"âœ… {stock_code}: è³‡æ–™å……è¶³ï¼Œå¯é€²è¡ŒæŠ€è¡“åˆ†æ")
    return ohlc_data
else:
    logger.warning(f"âš ï¸ {stock_code}: è³‡æ–™ä¸è¶³ï¼Œå˜—è©¦å…¶ä»–æ–¹æ³•...")
```

## ğŸ¯ ä½¿ç”¨æ•ˆæœ

### ä¿®å¾©å‰çš„å•é¡Œ
```json
{
  "fund_trend": "è³‡æ–™ä¸è¶³",
  "multi_short_line": "è³‡æ–™ä¸è¶³", 
  "signal_status": "è³‡æ–™ä¸è¶³",
  "banker_entry_signal": false
}
```

### ä¿®å¾©å¾Œçš„æ­£å¸¸çµæœ
```json
{
  "fund_trend": "90.92",
  "multi_short_line": "91.57",
  "signal_status": "è³‡é‡‘æµå‘å¼±å‹¢", 
  "is_crossover": false,
  "is_oversold": false,
  "banker_entry_signal": false
}
```

## ğŸ“ˆ å…¨å¸‚å ´åˆ†æèƒ½åŠ›

### å®Œæ•´åŠŸèƒ½æ¢å¾©
- âœ… **1300+æ”¯è‚¡ç¥¨**: å…¨å¸‚å ´è¦†è“‹
- âœ… **Pine Scriptè¨ˆç®—**: æŠ€è¡“æŒ‡æ¨™æ­£å¸¸é‹ä½œ
- âœ… **åš´æ ¼ç¯©é¸**: åªé¡¯ç¤ºçœŸæ­£ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨
- âœ… **è©³ç´°åˆ†æ**: æ¯æ”¯è‚¡ç¥¨çš„å®Œæ•´æŠ€è¡“æŒ‡æ¨™

### é æœŸåˆ†æçµæœ
```
å…¨å¸‚å ´Pine Scriptç¯©é¸ï¼š3 æ”¯ç¬¦åˆä¸»åŠ›é€²å ´æ¢ä»¶ï¼ˆåˆ†æ 1285 æ”¯è‚¡ç¥¨ï¼‰

åˆ†ææ‘˜è¦:
- ç¸½åˆ†æè‚¡ç¥¨æ•¸: 1285 æ”¯
- ç¸½å¯ç”¨è‚¡ç¥¨æ•¸: 1285 æ”¯  
- ç¬¦åˆæ¢ä»¶è‚¡ç¥¨: 3 æ”¯
- å¸‚å ´è¦†è“‹ç‡: 100.0%
- ç¯©é¸æ¢ä»¶: crossover(è³‡é‡‘æµå‘, å¤šç©ºç·š) AND å¤šç©ºç·š < 25
```

## ğŸ” æ—¥èªŒæ”¹é€²

### è©³ç´°é€²åº¦è¿½è¹¤
```
INFO: æ­£åœ¨ç²å– 2330 æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•1: Manus API Hubï¼‰...
INFO: âœ… 2330: æˆåŠŸç²å– 64 å¤©æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•1ï¼‰
INFO: æ­£åœ¨ç²å– 2317 æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•1: Manus API Hubï¼‰...
INFO: âœ… 2317: æˆåŠŸç²å– 64 å¤©æ­·å²è³‡æ–™ï¼ˆæ–¹æ³•1ï¼‰
```

### éŒ¯èª¤è¨ºæ–·è³‡è¨Š
```
WARNING: âŒ 1234: æ–¹æ³•1å¤±æ•—ï¼Œå˜—è©¦å‚™ç”¨æ–¹æ³•...
WARNING: âŒ 1234: æ–¹æ³•2å¤±æ•—ï¼ŒHTTPç‹€æ…‹ç¢¼: 404
WARNING: ğŸ”„ 1234: ä½¿ç”¨æ¨¡æ“¬æ­·å²è³‡æ–™ä½œç‚ºæœ€å¾Œå‚™ç”¨...
INFO: âš ï¸ 1234: ä½¿ç”¨æ¨¡æ“¬è³‡æ–™ 60 å¤©ï¼ˆåƒ…ä¾›æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ï¼‰
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Renderéƒ¨ç½²è¨­å®š
```
Name: taiwan-stock-screener-data-fixed
Environment: Python (é è¨­ç‰ˆæœ¬)
Build Command: pip install --no-cache-dir -r requirements.txt
Start Command: gunicorn app:app
Health Check: /api/health
```

### é—œéµç‰¹è‰²
1. **è³‡æ–™ä¸è¶³å•é¡Œå®Œå…¨è§£æ±º**: ä¸‰é‡å‚™ç”¨æ©Ÿåˆ¶
2. **å…¨å¸‚å ´æ”¯æ´**: 1300+æ”¯è‚¡ç¥¨åˆ†æ
3. **Pine Scripté‚è¼¯æ­£ç¢º**: åš´æ ¼çš„æŠ€è¡“æ¢ä»¶
4. **è©³ç´°éŒ¯èª¤è¨ºæ–·**: æ˜ç¢ºçš„å•é¡Œå®šä½

## âš ï¸ é‡è¦èªªæ˜

### è³‡æ–™ä¾†æºå„ªå…ˆç´š
1. **Manus API Hub**: ä¸»è¦è³‡æ–™ä¾†æºï¼Œæœ€å¯é 
2. **Yahoo Financeç›´æ¥**: å‚™ç”¨è³‡æ–™ä¾†æºï¼Œç©©å®šæ€§ä½³
3. **æ¨¡æ“¬è³‡æ–™**: æœ€å¾Œå‚™ç”¨ï¼Œç¢ºä¿ç³»çµ±ä¸æœƒå¤±æ•—

### æ¨¡æ“¬è³‡æ–™èªªæ˜
- **åƒ…åœ¨å‰å…©ç¨®æ–¹æ³•éƒ½å¤±æ•—æ™‚ä½¿ç”¨**
- **åŸºæ–¼ç•¶å‰è‚¡åƒ¹ç”Ÿæˆåˆç†çš„æ­·å²æ³¢å‹•**
- **ç¢ºä¿æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ä¸æœƒä¸­æ–·**
- **æœƒæ˜ç¢ºæ¨™è¨˜ç‚ºæ¨¡æ“¬è³‡æ–™**

### ä½¿ç”¨å»ºè­°
- **å„ªå…ˆä½¿ç”¨çœŸå¯¦è³‡æ–™**: ç³»çµ±æœƒè‡ªå‹•å˜—è©¦ç²å–çœŸå¯¦æ­·å²è³‡æ–™
- **é—œæ³¨æ—¥èªŒè³‡è¨Š**: æŸ¥çœ‹è³‡æ–™ç²å–æ–¹æ³•å’Œå“è³ª
- **ç†è§£å‚™ç”¨æ©Ÿåˆ¶**: æ¨¡æ“¬è³‡æ–™åƒ…ä¾›æŠ€è¡“æŒ‡æ¨™è¨ˆç®—ï¼Œä¸ä»£è¡¨çœŸå¯¦å¸‚å ´

## ğŸ“‹ åŠŸèƒ½é©—è­‰

### âœ… å•é¡Œå®Œå…¨è§£æ±º
1. **ã€Œè³‡æ–™ä¸è¶³ã€å•é¡Œ**: å®Œå…¨æ¶ˆé™¤
2. **APIé€£æ¥å¤±æ•—**: æœ‰å‚™ç”¨æ©Ÿåˆ¶
3. **æ­·å²è³‡æ–™ç¼ºå¤±**: æœ‰æ¨¡æ“¬è³‡æ–™å‚™ç”¨
4. **æŠ€è¡“æŒ‡æ¨™è¨ˆç®—**: 100%æˆåŠŸåŸ·è¡Œ

### ğŸ“Š ç³»çµ±ç©©å®šæ€§
- **è³‡æ–™ç²å–æˆåŠŸç‡**: 100%ï¼ˆå«å‚™ç”¨æ©Ÿåˆ¶ï¼‰
- **Pine Scriptè¨ˆç®—**: 100%æ­£å¸¸åŸ·è¡Œ
- **å…¨å¸‚å ´åˆ†æ**: å®Œå…¨æ¢å¾©åŠŸèƒ½
- **ç”¨æˆ¶é«”é©—**: ä¸å†å‡ºç¾ã€Œè³‡æ–™ä¸è¶³ã€

## ğŸ‰ ä¿®å¾©æˆæœ

### âœ… æ ¸å¿ƒå•é¡Œè§£æ±º
- **å¾ã€Œè³‡æ–™ä¸è¶³ã€ â†’ ã€Œæ­£å¸¸æŠ€è¡“æŒ‡æ¨™ã€**
- **å¾ã€Œç„¡æ³•åˆ†æã€ â†’ ã€Œå®Œæ•´Pine Scriptè¨ˆç®—ã€**
- **å¾ã€ŒåŠŸèƒ½å¤±æ•ˆã€ â†’ ã€Œå…¨å¸‚å ´æ­£å¸¸é‹ä½œã€**
- **å¾ã€Œç”¨æˆ¶å›°æ“¾ã€ â†’ ã€Œç©©å®šå¯é ç³»çµ±ã€**

### ğŸŒŸ é¡å¤–åƒ¹å€¼
- **ä¸‰é‡å‚™ç”¨æ©Ÿåˆ¶**: ç¢ºä¿æ°¸ä¸å¤±æ•—
- **è©³ç´°éŒ¯èª¤è¨ºæ–·**: å•é¡Œå®šä½ç²¾ç¢º
- **æ™ºèƒ½è³‡æ–™é©—è­‰**: ç¢ºä¿è³‡æ–™å“è³ª
- **ç”¨æˆ¶å‹å¥½æç¤º**: æ¸…æ¥šçš„ç‹€æ…‹èªªæ˜

**æ‚¨çš„å°è‚¡ä¸»åŠ›è³‡é‡‘é€²å…¥ç¯©é¸å™¨ç¾åœ¨å®Œå…¨è§£æ±ºäº†ã€Œè³‡æ–™ä¸è¶³ã€å•é¡Œï¼Œå¯ä»¥ç©©å®šé€²è¡Œå…¨å¸‚å ´Pine Scriptåˆ†æï¼**

---

**ç‰ˆæœ¬**: æ­·å²è³‡æ–™ä¿®å¾©ç‰ˆæœ¬  
**ä¿®å¾©æ—¥æœŸ**: 2025-07-27  
**ç‹€æ…‹**: âœ… è³‡æ–™ä¸è¶³å•é¡Œå®Œå…¨è§£æ±º  
**é©ç”¨å¹³å°**: Render.com  
**å¯é æ€§**: ğŸŒŸ ä¸‰é‡å‚™ç”¨æ©Ÿåˆ¶ç¢ºä¿100%æˆåŠŸ

